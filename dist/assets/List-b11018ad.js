import{r as s,R as c,a as Ue,s as Ve,j as C,b as _,L as le,n as We}from"./index-0a09aeff.js";import{c as re,u as H,L as He,U as Ye,a as oe,b as Ge,d as Qe,g as Ze,e as be,B as te,p as ce,f as qe,h as Ke,i as Je,j as Xe,k as et,O as tt,P as rt,T as ot,Q as nt}from"./index-e46dfb26.js";import{I as at}from"./IconTrashLines-92df4568.js";import{I as st}from"./IconPlus-20517615.js";import{I as it}from"./IconEye-3ae59d18.js";import{a as X}from"./axios-1779699b.js";import"react-quill/dist/quill.snow.css";import"./floating-ui.dom-43b344ff.js";function lt(){if(typeof window>"u"||typeof document>"u")return 0;const e=parseInt(window.getComputedStyle(document.body).paddingRight,10),t=window.innerWidth-document.documentElement.clientWidth;return e+t}const ct=({disableBodyPadding:e})=>{const t=e?null:lt();return`body {
        --removed-scroll-width: ${t}px;
        touch-action: none;
        overflow: hidden !important;
        position: relative !important;
        ${t?"padding-right: var(--removed-scroll-width) !important;":""}
        `};function dt(e,t){e.styleSheet?e.styleSheet.cssText=t:e.appendChild(document.createTextNode(t))}function ut(e){(document.head||document.getElementsByTagName("head")[0]).appendChild(e)}function pt(){const e=document.createElement("style");return e.type="text/css",e.setAttribute("mantine-scroll-lock",""),e}function ft(e,t={disableBodyPadding:!1}){const[r,o]=s.useState(e||!1),a=s.useRef(0),{disableBodyPadding:i}=t,u=s.useRef(null),d=()=>{a.current=window.scrollY;const v=ct({disableBodyPadding:i}),p=pt();dt(p,v),ut(p),u.current=p},m=()=>{u!=null&&u.current&&(u.current.parentNode.removeChild(u.current),u.current=null)};return s.useEffect(()=>(r?d():m(),m),[r]),s.useEffect(()=>{e!==void 0&&o(e)},[e]),s.useEffect(()=>{e===void 0&&typeof window<"u"&&window.document.body.style.overflow==="hidden"&&o(!0)},[o]),[r,o]}var mt=Object.defineProperty,vt=Object.defineProperties,gt=Object.getOwnPropertyDescriptors,de=Object.getOwnPropertySymbols,yt=Object.prototype.hasOwnProperty,ht=Object.prototype.propertyIsEnumerable,ue=(e,t,r)=>t in e?mt(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,Oe=(e,t)=>{for(var r in t||(t={}))yt.call(t,r)&&ue(e,r,t[r]);if(de)for(var r of de(t))ht.call(t,r)&&ue(e,r,t[r]);return e},wt=(e,t)=>vt(e,gt(t));const D={xs:18,sm:22,md:28,lg:34,xl:44};function _t({variant:e,theme:t,color:r,gradient:o}){const a=t.fn.variant({color:r,variant:e,gradient:o});return e==="gradient"?{border:0,backgroundImage:a.background,color:a.color,"&:hover":t.fn.hover({backgroundSize:"200%"})}:Oe({border:`1px solid ${a.border}`,backgroundColor:a.background,color:a.color},t.fn.hover({backgroundColor:a.hover}))}var bt=re((e,{color:t,size:r,radius:o,variant:a,gradient:i})=>({root:wt(Oe({},_t({variant:a,theme:e,color:t,gradient:i})),{position:"relative",height:e.fn.size({size:r,sizes:D}),minHeight:e.fn.size({size:r,sizes:D}),width:e.fn.size({size:r,sizes:D}),minWidth:e.fn.size({size:r,sizes:D}),borderRadius:e.fn.radius(o),padding:0,lineHeight:1,display:"flex",alignItems:"center",justifyContent:"center","&:active":e.activeStyles,"&:disabled, &[data-disabled]":{color:e.colors.gray[e.colorScheme==="dark"?6:4],cursor:"not-allowed",backgroundColor:a==="transparent"?void 0:e.fn.themeColor("gray",e.colorScheme==="dark"?8:1),borderColor:a==="transparent"?void 0:e.fn.themeColor("gray",e.colorScheme==="dark"?8:1),backgroundImage:"none",pointerEvents:"none","&:active":{transform:"none"}},"&[data-loading]":{pointerEvents:"none","&::before":{content:'""',position:"absolute",top:-1,left:-1,right:-1,bottom:-1,backgroundColor:e.colorScheme==="dark"?e.fn.rgba(e.colors.dark[7],.5):"rgba(255, 255, 255, .5)",borderRadius:e.fn.radius(o),cursor:"not-allowed"}}})}));const Ot=bt;var Pt=Object.defineProperty,M=Object.getOwnPropertySymbols,Pe=Object.prototype.hasOwnProperty,Se=Object.prototype.propertyIsEnumerable,pe=(e,t,r)=>t in e?Pt(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,fe=(e,t)=>{for(var r in t||(t={}))Pe.call(t,r)&&pe(e,r,t[r]);if(M)for(var r of M(t))Se.call(t,r)&&pe(e,r,t[r]);return e},St=(e,t)=>{var r={};for(var o in e)Pe.call(e,o)&&t.indexOf(o)<0&&(r[o]=e[o]);if(e!=null&&M)for(var o of M(e))t.indexOf(o)<0&&Se.call(e,o)&&(r[o]=e[o]);return r};const It={color:"gray",size:"md",variant:"subtle",loading:!1},Ie=s.forwardRef((e,t)=>{const r=H("ActionIcon",It,e),{className:o,color:a,children:i,radius:u,size:d,variant:m,gradient:v,disabled:p,loaderProps:y,loading:f,unstyled:b}=r,O=St(r,["className","color","children","radius","size","variant","gradient","disabled","loaderProps","loading","unstyled"]),{classes:h,cx:S,theme:I}=Ot({size:d,radius:u,color:a,variant:m,gradient:v},{name:"ActionIcon",unstyled:b}),x=I.fn.variant({color:a,variant:m}),k=c.createElement(He,fe({color:x.color,size:I.fn.size({size:d,sizes:D})-12},y));return c.createElement(Ye,fe({className:S(h.root,o),ref:t,disabled:p,"data-disabled":p||void 0,"data-loading":f||void 0,unstyled:b},O),f?k:i)});Ie.displayName="@mantine/core/ActionIcon";const xt=oe(Ie);var Et=Object.defineProperty,me=Object.getOwnPropertySymbols,$t=Object.prototype.hasOwnProperty,Ct=Object.prototype.propertyIsEnumerable,ve=(e,t,r)=>t in e?Et(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,Nt=(e,t)=>{for(var r in t||(t={}))$t.call(t,r)&&ve(e,r,t[r]);if(me)for(var r of me(t))Ct.call(t,r)&&ve(e,r,t[r]);return e};function xe(e){return c.createElement("svg",Nt({viewBox:"0 0 15 15",fill:"none",xmlns:"http://www.w3.org/2000/svg"},e),c.createElement("path",{d:"M11.7816 4.03157C12.0062 3.80702 12.0062 3.44295 11.7816 3.2184C11.5571 2.99385 11.193 2.99385 10.9685 3.2184L7.50005 6.68682L4.03164 3.2184C3.80708 2.99385 3.44301 2.99385 3.21846 3.2184C2.99391 3.44295 2.99391 3.80702 3.21846 4.03157L6.68688 7.49999L3.21846 10.9684C2.99391 11.193 2.99391 11.557 3.21846 11.7816C3.44301 12.0061 3.80708 12.0061 4.03164 11.7816L7.50005 8.31316L10.9685 11.7816C11.193 12.0061 11.5571 12.0061 11.7816 11.7816C12.0062 11.557 12.0062 11.193 11.7816 10.9684L8.31322 7.49999L11.7816 4.03157Z",fill:"currentColor",fillRule:"evenodd",clipRule:"evenodd"}))}xe.displayName="@mantine/core/CloseIcon";var kt=Object.defineProperty,U=Object.getOwnPropertySymbols,Ee=Object.prototype.hasOwnProperty,$e=Object.prototype.propertyIsEnumerable,ge=(e,t,r)=>t in e?kt(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,Rt=(e,t)=>{for(var r in t||(t={}))Ee.call(t,r)&&ge(e,r,t[r]);if(U)for(var r of U(t))$e.call(t,r)&&ge(e,r,t[r]);return e},zt=(e,t)=>{var r={};for(var o in e)Ee.call(e,o)&&t.indexOf(o)<0&&(r[o]=e[o]);if(e!=null&&U)for(var o of U(e))t.indexOf(o)<0&&$e.call(e,o)&&(r[o]=e[o]);return r};const Tt={xs:12,sm:14,md:16,lg:20,xl:24},jt={size:"md"},Ce=s.forwardRef((e,t)=>{const r=H("CloseButton",jt,e),{iconSize:o,size:a="md"}=r,i=zt(r,["iconSize","size"]),u=Ge(),d=o||u.fn.size({size:a,sizes:Tt});return c.createElement(xt,Rt({size:a,ref:t},i),c.createElement(xe,{width:d,height:d}))});Ce.displayName="@mantine/core/CloseButton";const Dt=oe(Ce);function Ne({transitions:e,duration:t=250,exitDuration:r=t,mounted:o,children:a,timingFunction:i,onExit:u,onEntered:d,onEnter:m,onExited:v}){const{transitionDuration:p,transitionStatus:y,transitionTimingFunction:f}=Qe({mounted:o,duration:t,exitDuration:r,timingFunction:i,onExit:u,onEntered:d,onEnter:m,onExited:v});if(p===0)return o?c.createElement(c.Fragment,null,a({})):null;if(y==="exited")return null;const b=Object.keys(e).reduce((O,h)=>(O[h]=Ze({duration:e[h].duration,transition:e[h].transition,timingFunction:e[h].timingFunction||f,state:y}),O),{});return c.createElement(c.Fragment,null,a(b))}Ne.displayName="@mantine/core/GroupedTransition";var Lt=re((e,{zIndex:t})=>({root:{position:"absolute",top:0,bottom:0,left:0,right:0,zIndex:t}}));const Ft=Lt;var Bt=Object.defineProperty,At=Object.defineProperties,Mt=Object.getOwnPropertyDescriptors,V=Object.getOwnPropertySymbols,ke=Object.prototype.hasOwnProperty,Re=Object.prototype.propertyIsEnumerable,ye=(e,t,r)=>t in e?Bt(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,ee=(e,t)=>{for(var r in t||(t={}))ke.call(t,r)&&ye(e,r,t[r]);if(V)for(var r of V(t))Re.call(t,r)&&ye(e,r,t[r]);return e},Ut=(e,t)=>At(e,Mt(t)),Vt=(e,t)=>{var r={};for(var o in e)ke.call(e,o)&&t.indexOf(o)<0&&(r[o]=e[o]);if(e!=null&&V)for(var o of V(e))t.indexOf(o)<0&&Re.call(e,o)&&(r[o]=e[o]);return r};const Wt={opacity:.6,color:"#fff",zIndex:be("modal"),radius:0,blur:0},ze=s.forwardRef((e,t)=>{const r=H("Overlay",Wt,e),{opacity:o,blur:a,color:i,gradient:u,zIndex:d,radius:m,sx:v,unstyled:p,className:y}=r,f=Vt(r,["opacity","blur","color","gradient","zIndex","radius","sx","unstyled","className"]),{classes:b,cx:O}=Ft({zIndex:d},{name:"Overlay",unstyled:p}),h=u?{backgroundImage:u}:{backgroundColor:i},S=I=>c.createElement(te,ee({ref:t,className:O(b.root,y),sx:[x=>Ut(ee({},h),{opacity:o,borderRadius:x.fn.size({size:m,sizes:x.radius})}),...ce(v)]},I));return a?c.createElement(te,ee({className:O(b.root,y),sx:[{backdropFilter:`blur(${a}px)`},...ce(v)]},f),S()):S(f)});ze.displayName="@mantine/core/Overlay";const Ht=oe(ze);var Yt=Object.defineProperty,he=Object.getOwnPropertySymbols,Gt=Object.prototype.hasOwnProperty,Qt=Object.prototype.propertyIsEnumerable,we=(e,t,r)=>t in e?Yt(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,Zt=(e,t)=>{for(var r in t||(t={}))Gt.call(t,r)&&we(e,r,t[r]);if(he)for(var r of he(t))Qt.call(t,r)&&we(e,r,t[r]);return e};const qt={xs:320,sm:380,md:440,lg:620,xl:780};function Kt(e){return e?{position:"absolute",top:0,left:0,right:0,bottom:0,maxHeight:"100vh",overflowY:"auto"}:{}}var Jt=re((e,{overflow:t,size:r,centered:o,zIndex:a,fullScreen:i})=>({close:{},overlay:{display:i?"none":void 0},root:{position:"fixed",zIndex:a,top:0,left:0,right:0,bottom:0},inner:{position:"absolute",top:0,left:0,right:0,bottom:0,overflowY:"auto",padding:i?0:`${e.spacing.xl*2}px ${e.spacing.md}px`,display:"flex",justifyContent:"center",alignItems:o?"center":"flex-start"},title:{marginRight:e.spacing.md,textOverflow:"ellipsis",display:"block",wordBreak:"break-word"},modal:Zt({position:"relative",width:i?"100vw":e.fn.size({sizes:qt,size:r}),borderRadius:i?0:void 0,outline:0,backgroundColor:e.colorScheme==="dark"?e.colors.dark[7]:e.white,marginTop:o?"auto":void 0,marginBottom:o?"auto":void 0,zIndex:1},Kt(i)),header:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:e.spacing.md,marginRight:-9},body:{maxHeight:t==="inside"?"calc(100vh - 185px)":null,overflowY:t==="inside"?"auto":null,wordBreak:"break-word"}}));const Xt=Jt;var er=Object.defineProperty,W=Object.getOwnPropertySymbols,Te=Object.prototype.hasOwnProperty,je=Object.prototype.propertyIsEnumerable,_e=(e,t,r)=>t in e?er(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,tr=(e,t)=>{for(var r in t||(t={}))Te.call(t,r)&&_e(e,r,t[r]);if(W)for(var r of W(t))je.call(t,r)&&_e(e,r,t[r]);return e},rr=(e,t)=>{var r={};for(var o in e)Te.call(e,o)&&t.indexOf(o)<0&&(r[o]=e[o]);if(e!=null&&W)for(var o of W(e))t.indexOf(o)<0&&je.call(e,o)&&(r[o]=e[o]);return r};const or={size:"md",transitionDuration:250,overflow:"outside",padding:"lg",shadow:"lg",closeOnClickOutside:!0,closeOnEscape:!0,trapFocus:!0,withCloseButton:!0,withinPortal:!0,lockScroll:!0,withFocusReturn:!0,overlayBlur:0,zIndex:be("modal"),exitTransitionDuration:0};function De(e){const t=H("Modal",or,e),{className:r,opened:o,title:a,onClose:i,children:u,withCloseButton:d,overlayOpacity:m,size:v,transitionDuration:p,exitTransitionDuration:y,closeButtonLabel:f,overlayColor:b,overflow:O,transition:h,padding:S,shadow:I,radius:x,id:k,classNames:Y,styles:G,closeOnClickOutside:Q,trapFocus:N,closeOnEscape:T,centered:Z,target:q,withinPortal:K,zIndex:L,overlayBlur:J,transitionTimingFunction:F,fullScreen:n,unstyled:l,lockScroll:w,withFocusReturn:R}=t,E=rr(t,["className","opened","title","onClose","children","withCloseButton","overlayOpacity","size","transitionDuration","exitTransitionDuration","closeButtonLabel","overlayColor","overflow","transition","padding","shadow","radius","id","classNames","styles","closeOnClickOutside","trapFocus","closeOnEscape","centered","target","withinPortal","zIndex","overlayBlur","transitionTimingFunction","fullScreen","unstyled","lockScroll","withFocusReturn"]),g=qe(k),P=`${g}-title`,j=`${g}-body`,{classes:$,cx:Le,theme:B}=Xt({size:v,overflow:O,centered:Z,zIndex:L,fullScreen:n},{unstyled:l,classNames:Y,styles:G,name:"Modal"}),Fe=Ke(N&&o),ne=s.useRef(null),Be=Je(Fe,ne),Ae=typeof m=="number"?m:B.colorScheme==="dark"?.85:.75;ft(w&&o);const ae=z=>{!N&&z.key==="Escape"&&T&&i()};s.useEffect(()=>{if(!N)return window.addEventListener("keydown",ae),()=>window.removeEventListener("keydown",ae)},[N]),Xe({opened:o,shouldReturnFocus:N&&R});const se=s.useRef(null);et("mousedown",z=>{se.current=z.target});const Me=()=>{se.current===ne.current&&Q&&i()};return c.createElement(tt,{withinPortal:K,target:q},c.createElement(Ne,{mounted:o,duration:p,exitDuration:y,timingFunction:F,transitions:{modal:{duration:p,transition:h||(n?"fade":"pop")},overlay:{duration:p/2,transition:"fade",timingFunction:"ease"}}},z=>c.createElement(c.Fragment,null,c.createElement(te,tr({id:g,className:Le($.root,r)},E),c.createElement("div",{style:z.overlay},c.createElement(Ht,{className:$.overlay,sx:{position:"fixed"},zIndex:0,blur:J,color:b||(B.colorScheme==="dark"?B.colors.dark[9]:B.black),opacity:Ae,unstyled:l})),c.createElement("div",{role:"presentation",className:$.inner,onClick:Me,onKeyDown:A=>{var ie;((ie=A.target)==null?void 0:ie.getAttribute("data-mantine-stop-propagation"))!=="true"&&A.key==="Escape"&&T&&i()},ref:Be},c.createElement(rt,{className:$.modal,shadow:I,p:S,radius:x,role:"dialog","aria-labelledby":P,"aria-describedby":j,"aria-modal":!0,tabIndex:-1,style:z.modal,unstyled:l,onClick:A=>A.stopPropagation()},(a||d)&&c.createElement("div",{className:$.header},c.createElement(ot,{id:P,className:$.title},a),d&&c.createElement(Dt,{iconSize:16,onClick:i,"aria-label":f,className:$.close})),c.createElement("div",{id:j,className:$.body},u)))))))}De.displayName="@mantine/core/Modal";const fr=()=>{const e=Ue();s.useEffect(()=>{e(Ve("Invoice List"))},[e]);const[t,r]=s.useState([]),[o,a]=s.useState({}),[i,u]=s.useState(1),[d]=s.useState(15),[m,v]=s.useState(1),[p,y]=s.useState([]),[f,b]=s.useState("");s.useState({});const[O,h]=s.useState({columnAccessor:"invoiceRef",direction:"asc"}),[S,I]=s.useState(null),[x,k]=s.useState(!1),[Y,G]=s.useState(0),[Q,N]=s.useState(0);s.useEffect(()=>{T()},[]),s.useEffect(()=>{const n=t.filter(E=>{var j;const g=E.invoiceRef.toLowerCase().includes(f.toLowerCase()),P=(j=o[E.customerId])==null?void 0:j.username.toLowerCase().includes(f.toLowerCase());return g||P});G(n.length);const l=n.reduce((E,g)=>E+g.total,0);N(l),v(Math.ceil(n.length/d));const w=(i-1)*d,R=w+d;y(n.slice(w,R))},[i,t,f,d,o]);const T=async()=>{try{const l=(await X.get("http://localhost:3000/api/invoices")).data;r(l),v(Math.ceil(l.length/d)),y(l.slice(0,d)),Z(l);const w=l.map(R=>R.orderId).filter(Boolean);await q(w,l)}catch(n){console.error("Error fetching invoices:",n)}},Z=async n=>{const l=[...new Set(n.map(w=>w.customerId))];try{const w=l.map(async g=>{const P=await X.get(`http://localhost:3000/api/users/${g}`);return{customerId:g,username:P.data.username,userType:P.data.userType}}),E=(await Promise.all(w)).reduce((g,P)=>(g[P.customerId]={username:P.username,userType:P.userType},g),{});a(E)}catch(w){console.error("Error fetching user data:",w)}},q=async(n,l)=>{},K=async n=>{try{await X.delete(`http://localhost:3000/api/invoices/${n}`),T()}catch(l){console.error("Error deleting invoice:",l)}},L=n=>{const l={year:"numeric",month:"long",day:"numeric"};return new Date(n).toLocaleDateString("en-US",l)},J=n=>{I(n),k(!0)},F=n=>n.toLocaleString("de-DE",{minimumFractionDigits:2});return C("div",{className:"panel px-0 border-white-light dark:border-[#1b2e4b]",children:[C("div",{className:"invoice-table",children:[C("div",{className:"mb-4 px-5 flex md:items-center md:flex-row flex-col gap-5",children:[C("div",{className:"flex items-center gap-2",children:[C("button",{type:"button",className:"btn btn-danger gap-2",onClick:()=>{var n;return((n=t[0])==null?void 0:n._id)&&K(t[0]._id)},children:[_(at,{}),"Delete"]}),C(le,{to:"/apps/invoice/add",className:"btn btn-primary gap-2",children:[_(st,{}),"Add New"]})]}),_("div",{className:"ltr:ml-auto rtl:mr-auto",children:_("input",{type:"text",className:"form-input w-auto",placeholder:"Search by invoice or customer...",value:f,onChange:n=>b(n.target.value)})})]}),_("div",{className:"px-5 mb-4",children:C("h3",{className:"text-lg font-semibold",children:[Y," invoice(s) found. Total Amount: ",F(Q)," DH"]})}),_("div",{className:"datatables pagination-padding",children:_(nt,{records:p,columns:[{accessor:"invoiceRef",title:"Invoice",render:n=>n.invoiceRef.replace("INV-","")},{accessor:"customerId",title:"Customer",render:n=>{var l;return((l=o[n.customerId])==null?void 0:l.username)||"Unknown"}},{accessor:"userType",title:"User Type",render:n=>{var l;return((l=o[n.customerId])==null?void 0:l.userType)||"Unknown"}},{accessor:"total",title:"Total Amount",render:n=>F(n.total)},{accessor:"dueDate",title:"Due Date",render:n=>L(n.dueDate||"")},{accessor:"fetchedAt",title:"Fetched At",render:n=>L(n.fetchedAt)},{accessor:"actions",title:"Actions",render:n=>C("div",{className:"flex items-center justify-center gap-2",children:[_("button",{onClick:()=>J(n),children:_(it,{})}),_(le,{to:`/apps/invoice/edit/${n._id}`,children:_(We,{})})]})}],totalRecords:t.length,page:i,onPageChange:u,recordsPerPage:d,sortStatus:O,onSortStatusChange:h})})]}),S&&_(De,{opened:x,onClose:()=>k(!1),title:`Invoice Details: ${S.invoiceRef}`})]})};export{fr as default};
